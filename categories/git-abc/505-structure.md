# 리포지터리 구조

### SHA1 파일명

리포지터리에 저장되는 파일은 파일내용의 SHA1 해쉬를 이름으로 사용한다.

	$ git ls-tree master
	100644 blob 8baef1b4abc478178b004d62031cf7fe6db6f903	readme.md
	100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	three.md
	100644 blob 2abcdfd5c0c7573ff9bb3e8cdb75c93590aa0460	two.md

	$ git show 8baef1
	...

	$ git log -1
	commit 53659d1e966f312cdc37addb06a7e2e20e33615f
	Author: drypot <drypot@gmail.com>
	...

	$ git show 53659d1
	...
	
SHA1 해쉬는 20 byte (40 문자) 로 구성되는 16 진수 숫자열이다.  
블롭, 트리, 커밋, 태그 파일 모두 SHA1 해쉬를 이름으로 갖는다.  
SHA1 해쉬가 같은 파일들은 한 벌만 저장된다.

이름 대신 SHA1 해쉬를 쓰므로 커밋이 겹겹이 쌓인 상태에서도 SHA1 해쉬만 가지고 특정 버전의 파일을 쉽게 가리킬 수 있다.  
트리 오브젝트의 해쉬가 같다면 서브 디렉토리 모든 파일을 비교하지 않고도 두 디렉토리 내용이 같다는 보장을 얻을 수 있다.  
해쉬만으로 동일여부를 판단하므로 매우 큰 오브젝트들의 존재 유무를 데이터 전송없이 알아낼 수 있다.  

내용이 다른 파일간 SHA1 해쉬가 충돌할 가능성은 있다. 하지만 엄청나게 낮다.  
충돌나면 어떻게 되는지에 대한 말은 안 보인다. =,=


### 인덱스

리포지터리에는 오브젝트 스토어와 인덱스, 두 개의 주요 데이터가 있다.

오브젝트 스토어는 커밋 데이터를 저장한다.  
인덱스는 오브젝트 스토어에 커밋할 내용을 임시 저장한다.  
인덱스가 필요한 것은 수정한 파일을 선별적으로 커밋할 필요가 있기 때문이다.

새로 트래킹할 파일이나 커밋 후 수정한 파일은 `git add` 명령으로 인덱스에 등록한다.  
파일에 대한 블롭은 파일을 인덱스에 등록할 때 미리 생성하고 
트리 오브젝트는 인덱스를 가지고 커밋시 생성한다.

코딩작업의 한 단위가 끝났으면 `git commit` 명령으로 커밋한다.  
커밋은 새로운 트리 오브젝트와 커밋 오브젝트를 만드는 일이다.  
블롭들의 변화에 따라 트리들이 추가될 수도 있고 기존 것들이 재사용될 수도 있다.  
새 커밋 오브젝트는 바로 이전 커밋에 대한 링크를 갖고 브랜치는 새로 생성된 커밋의 링크를 갖도록 업데이트된다.

커밋 전에 한 파일을 여러번 인덱싱하면 고아 블롭이 발생한다.

클론시 인덱스는 복사되지 않는다.


### 오브젝트 스토어

기록에 관해 상상할 수 있는 모든 것은 여기에 저장된다.  
파일 시스템상의 평범한 디렉토리다.  
오브젝트 스토어 구조는 리포지터리를 효율적으로 클론할 수 있도록 만들어졌다.  
오브젝트 스토어에 저장되는 오브젝트는 딱 네 종류다.

* 블롭

	파일의 버젼들은 블롭으로 저장된다.  
	블롭에는 파일 데이터만 저장된다. 파일 이름은 저장되지 않는다.  
	Git 는 diff 결과를 저장하지 않는다. 모든 파일의 모든 버전들을 원본 그대로 저장한다.  
	diff 는 필요할 때마다 계산해서 표시한다.  
	블롭은 데이터 구조의 최하단에 있으며 다른 오브젝트에 대한 링크를 갖지 않는다.

* 트리

	블롭의 해쉬, 패스, 기타 메타 정보가 기록된다.  
	트리 오브젝트는 다른 트리나 블롭에 대한 링크를 갖는다.

* 커밋

	커밋에는 커밋 메타 데이터와 커밋 과정에서 만들어진 루트 트리의 링크가 저장된다.  
	커밋은 이전 커밋에 대한 링크를 가진다.  
	머지의 결과로 만들어진 커밋은 여러 부모 커밋을 갖는다.  
	서로 다른 커밋 오브젝트가 같은 트리에 대한 링크를 가질 수 있다.

* 태그

	커밋에 사람이 읽기 쉬운 이름을 달기 위해 사용한다.
