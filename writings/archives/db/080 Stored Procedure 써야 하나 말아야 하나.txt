Stored Procedure 써야 하나, 말아야 하나
2011-03-21 15:27

SP 를 써야하나 말아야 하나에 대한 이야기를 꺼내면 성전이 벌어진다.
개인적으로 나는 쓰지 말아야한다는 파에 속한다.

물론 나도 한 5 년 전까지는 SP 신봉자였다.
지금도 SP 를 쓴다고 개발이 특히 어려워 지는 것은 아니다.

주로 거론되는 SP 의 장점에 반론을 적어보면,

### 빠르다

DB 에서 미리 컴파일되어 실행되기 때문에 실시간으로 파싱을 해야하는 SQL 보다 성능상 빠르다는 주장.

논란이 많은데 MySQL 은 구체적으로 어떻게 구현되어 있는지 모르겠지만
최근 상용 RDB 들 보면 쌩 Query 파싱 결과도 케쉬에 가지고 있다.
그러니 SP 만 파싱을 패스하므로 속도가 빨라진다는 말은 요즘 상용 디비들에는 적용하기가 어렵다.
파싱 오버헤드 때문에 SP 만들었는데, SP 자체가 디비에 더 무리를 줄 수 있다는 아이러니한 상황이 발생합니다.

긴 SQL 문을 DB로 보내는 것이 아니라 이름만(파라미터 포함)을 보내기 때문에 네트워크 트래픽이 절약된다.
-> 좀 께름직하긴 한데 거의 문제되지 않는 펙터라고 볼 수 있습니다. 무시해도 될듯.

DB 자체에 저장되기 때문에 어떤 응용에 상관없이 공유해서 사용할 수 있다.
-> 이런 이상적인 상황은 실제론 거의 발생하지가 않지요.
이보다는 새 버전 어플리케이션과 구 버전과 매칭이 안 되서
스토어드 프로시져를 두 벌 세 벌 만들어 너어야 하는 상황이 더 많이 발생합니다. =,=

DBA가 SP의 접근권한을 조정할 수 있기 때문에 안전하다.
-> 무시할 수 있느 펙터. 한국에서는 개발자가 어짜피 쿼리까지 다 칩니다. 안습. =,=

네, 그래서 보면 SP 론자들이 주장하는 바는 거의 다 반박할 수 있습니다.

그럼 SP 를 안 쓰고 쿼리 로직을 어플리케이션에 담았을 때의 장점.
준석 님이 적어주신 것 외에 전 이게 참 중요하다고 생각하는데.

어짜피 개발자가 자바 코드와 SQL 을 모두 치는데 그게 같은 곳에 있으면 작업이 훨씬 편해집니다.
SP 넣느라고 MySQL 관련 도구 사용하다가, 자바 코드 치느라고 자바 통합환경 쓰다가, 이거 불편하잔아요.
한군데 다 몰려 있으면 로직은 자바로 치고 입출력만 SQL 로 처리하는 것이 깔끔합니다.
코드 보는 사람도 이해하기 편하지요.

그리고, SQL 쿼리까지 버전 관리를 할 수 있습니다.
SP 쓰면 SP 코드 버전 관리 못합니다.
코드야 버전 관리 시스템에 넣어 둘 수 있겠지만,
테스트 디비의 SP와 자바 로직을 싱크할 수 없기 때문에
버전 왔다갔다 하면서 작업하는 것이 힘들어 집니다.

논란이 있고 반론도 많은 문제이긴 하지만,
SP 는 앞으로 쓰지 말자로 결론 내고 가도 아무 문제 발생하지 않습니다.
실제로 그렇게 작업해 보면 썩 괜찮고요.

디비 서버에 SP 수백 개 들어있고 담당자 퇴사한 상태면
그거 다 어떤 어플리케이션에서 사용되는 것인지 트래킹하는거 거의 불가능합니다.
자바 코드와 SQL 쿼리는 딱 붙여 놓아야 합니다.