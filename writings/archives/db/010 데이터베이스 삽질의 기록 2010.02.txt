데이터베이스 삽질의 기록 2010.02
drypot 2010-11-28 14:34
다른 글줄에서 데이터베이스로 Postgres 검토중이라고 적었었는데, 어제부로 드롭했다.
문제점 부터 찾아보니 select count 퍼포먼스가 무지 낮다고 한다.

이유는 MVCC 를 써서 커넥션마다 테이블 크기가 달라보이니, count 값을 케슁할 수가 없고,
count 를 계산할 행을 모두 검사해야하는데,
현재 MVCC 정책 때문에 인덱스도 탈 수도 없어서 실제 테이블 Full Scan 을 한다고 한다. =,=
MVCC 가 아무리 좋다고 하지만, 이건 아닌 것 같다.

해법은 사용자가 별도 카운트 테이블 만들어서,
데이터 넣고 지울 때마다 카운터 테이블 수치 업데이트. =,=
이건 해법도 아닌 것 같다.

MySQL InnoDB 도 MVCC 쓰는데 count 계산시 인덱스를 탈 수 있다고 한다.
근데 InnoDB 는 머지안아 사라질 분위기 같고 구조도 좀 이상해 보인다.
(오라클이 MySQL 을 인수하면서 이 분위기는 급반전되었다.)

1 만개 안쪽 레코드 가진 테이블에서는 걍 대충써도 된다고 나와 있고, 왠만하면 count 쓰지 말라고 하는데,
count 할 때마다 테이블 전체 메모리에 올리려 할 텐데 데이터 커지면 이걸 우짤 것이며,
트위터도 아닌데, 한국인 특성상 페이징 딱딱 되야하니 이게 가당키나 하단 말인가 싶다.

M$ SQL 에서도 MVCC 지원해서 레이소다에 현재 쓰고 있는데 얘는 어쩌고 있나 싶다.
레이소다 보믄 전혀 안 느린데.

디비는 어쩌다 보니 돌아돌아서 전국민이 애용하는 MySQL + MyISAM 으로 왔다.

대학 졸업 직후부터 트랜젝션 지원하는 디비만 써와서 이게 꼭 필수요소라고 머리에 박혀 있었는데,
트랜젝션을 아예 지원을 안 하니 여러 가지 고민들이 다 사라진다.

문서를 보니 트랜젝션 지원을 안 해도 MyISAM 안전하다고 계속 강조를 하고 있으니 믿고 더 들여다 보고 있다.
어찌보면 MyISAM 이 웹 사이트 만드는데는 최적의 구조일지도 모르겠단 생각도 든다.